--PART A
CREATE TABLE G10_DEPARTMENT (
	DEPARTMENT_ID CHAR(5) PRIMARY KEY,
	DEPARTMENT_NAME VARCHAR(30) NOT NULL,
);
/* Group 10 11-23-2021 */

CREATE TABLE G10_FACULTY(
	FACULTY_ID CHAR(5) PRIMARY KEY,
	FACULTY_FNAME VARCHAR(20) NOT NULL,
	FACULTY_LNAME VARCHAR(20) NOT NULL,
	DEPARTMENT_ID CHAR(5),
	FOREIGN KEY (DEPARTMENT_ID) REFERENCES G10_DEPARTMENT(DEPARTMENT_ID) ON DELETE NO ACTION ON UPDATE CASCADE,
);
/* Group 10 11-23-2021 */

CREATE TABLE G10_PROGRAM (
	PROGRAM_ID CHAR(5) PRIMARY KEY,
	PROGRAM_NAME VARCHAR(40) NOT NULL,
	PROGRAM_DATE_START DATE NOT NULL,
	PROGRAM_DATE_END DATE NOT NULL,
	FACULTY_ID CHAR(5),
	DEPARTMENT_ID CHAR(5),
	PROGRAM_BUDGET DECIMAL(5,2),
	PROGRAM_FEE DECIMAL (5,2)
	FOREIGN KEY (FACULTY_ID) REFERENCES G10_FACULTY(FACULTY_ID) ON DELETE SET NULL ON UPDATE CASCADE,
	FOREIGN KEY (DEPARTMENT_ID) REFERENCES G10_DEPARTMENT(DEPARTMENT_ID) ON DELETE NO ACTION ON UPDATE NO ACTION
);
/* Group 10 11-23-2021 */

CREATE TABLE G10_BUILDING (
	BUILDING_NUMBER CHAR(2) PRIMARY KEY,
	BUILDING_NAME VARCHAR(40) NOT NULL
);
/* Group 10 11-23-2021 */

CREATE TABLE G10_ROOM (
	ROOM_NUMBER CHAR(5),
	BUILDING_NUMBER CHAR(2),
	PROGRAM_ID CHAR(5),
	ROOM_CAPACITY INT,
	PRIMARY KEY (ROOM_NUMBER, BUILDING_NUMBER),
	FOREIGN KEY (BUILDING_NUMBER) REFERENCES G10_BUILDING(BUILDING_NUMBER),
	FOREIGN KEY (PROGRAM_ID) REFERENCES G10_PROGRAM(PROGRAM_ID) ON DELETE CASCADE ON UPDATE CASCADE
);
/* Group 10 11-23-2021 */

CREATE TABLE G10_STUDENT (
	STUDENT_ID CHAR(6) PRIMARY KEY,
	STUDENT_FNAME VARCHAR(40) NOT NULL,
	STUDENT_LNAME VARCHAR(40) NOT NULL,
	GRADE CHAR(1),
	PROGRAM_ID CHAR(5),
	FOREIGN KEY (PROGRAM_ID) REFERENCES G10_PROGRAM(PROGRAM_ID) ON DELETE SET NULL ON UPDATE CASCADE
);
/* Group 10 11-23-2021 */

CREATE TABLE G10_GUARDIAN(
	GUARDIAN_ID CHAR(6) PRIMARY KEY,
	GUARDIAN_FNAME VARCHAR(40) NOT NULL,
	GUARDIAN_LNAME VARCHAR(40) NOT NULL,
	GUARDIAN_AREA_CODE CHAR(3),
	GUARDIAN_PHONE_NUMBER CHAR(7)
);

/* Group 10 11-23-2021 */

CREATE TABLE G10_CONTACT(
	STUDENT_ID CHAR(6),
	GUARDIAN_ID CHAR(6),
	RELATIONSHIP_TYPE VARCHAR(20),
	PRIMARY KEY (STUDENT_ID, GUARDIAN_ID),
	FOREIGN KEY (STUDENT_ID) REFERENCES G10_STUDENT (STUDENT_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (GUARDIAN_ID) REFERENCES G10_GUARDIAN (GUARDIAN_ID) ON DELETE NO ACTION ON UPDATE CASCADE
);
/* Group 10 11-23-2021 */

--PART B
INSERT INTO G10_DEPARTMENT(DEPARTMENT_ID,DEPARTMENT_NAME) VALUES
('D1000', 'ENGLISH'),
('D2000', 'ART'),
('D3000', 'MUSIC'),
('D4000', 'ATHLETICS'),
('D5000', 'MATHEMATICS');
/* Group 10 11-23-2021 */

INSERT INTO G10_FACULTY(FACULTY_ID,FACULTY_FNAME,FACULTY_LNAME,DEPARTMENT_ID) VALUES
('F2304', 'Karen', 'Hayes', 'D1000'),
('F1330', 'Ryan', 'Ferber', 'D2000'),
('F2505', 'Patrick', 'Star', 'D3000'),
('F1234', 'Bohn', 'Jono', 'D4000'),
('F2366', 'Jack', 'Black', 'D5000'),
('F2341', 'Bob', 'Jonas', 'D2000'),
('F2342', 'Jay', 'Park', 'D3000');
/* Group 10 11-23-2021 */

INSERT INTO G10_PROGRAM(PROGRAM_ID, PROGRAM_NAME, PROGRAM_DATE_START, PROGRAM_DATE_END, FACULTY_ID, DEPARTMENT_ID, PROGRAM_BUDGET, PROGRAM_FEE) VALUES
('P1001', 'Book Club', '2021-10-01', '2021-12-17', 'F2304', 'D1000', 405.50, 5),
('P2001', 'Painting Club', '2021-09-01', '2021-12-17', 'F1330', 'D2000', 500, 15.50),
('P1002', 'Math Club', '2021-09-01', '2021-12-17', 'F2366', 'D5000', 800, 10),
('P1006', 'Basketball Club', '2021-10-10', '2021-12-17', 'F1234', 'D4000', 860, 25),
('P2004', 'Guitar Club', '2021-09-01', '2021-12-17', 'F2505', 'D3000', 670, 0),
('P2005', 'Clay Club', '2021-09-01', '2021-12-17', 'F2341', 'D2000', 670, 10),
('P2006', 'Piano Club', '2021-10-01', '2021-12-17', 'F2342', 'D3000', 750, 15);
/* Group 10 11-23-2021 */

INSERT INTO G10_BUILDING (BUILDING_NUMBER, BUILDING_NAME) VALUES
('B4', 'Kemal Hall'),
('B2', 'Phillips Hall'),
('B1', 'Akmal Hall'),
('B3', 'Olivia Hall'),
('B5', 'Mackenzie Hall');
/* Group 10 11-23-2021 */

INSERT INTO G10_ROOM (ROOM_NUMBER, BUILDING_NUMBER, PROGRAM_ID, ROOM_CAPACITY) VALUES
('R1203', 'B4', 'P1001',100),
('R1103', 'B2', 'P2001',200),
('R1209', 'B3', 'P2004',10),
('R2208', 'B4', 'P1006',20),
('R3231', 'B5', 'P1002',50);
/* Group 10 11-23-2021 */

INSERT INTO G10_STUDENT (STUDENT_ID, STUDENT_FNAME, STUDENT_LNAME, GRADE, PROGRAM_ID) VALUES
('S11200', 'Amy', 'Silverman', '3', 'P1001'),
('S11201', 'John', 'Berman', '2', 'P2001'),
('S11203', 'Josh', 'Snyder', 'K', 'P1002'),
('S11032', 'Sarah', 'Felder', '2', 'P1006'),
('S11304', 'Andrew', 'Dyson', '5', 'P2004'),
('S11404', 'Ben', 'Felder', '4', 'P1001');
/* Group 10 11-23-2021 */

INSERT INTO G10_GUARDIAN (GUARDIAN_ID, GUARDIAN_FNAME, GUARDIAN_LNAME, GUARDIAN_AREA_CODE, GUARDIAN_PHONE_NUMBER) VALUES
('G11448', 'Tom', 'Silverman', '914', '5552203'),
('G12395', 'Nancy', 'Berman', '516', '5556809'),
('G13598', 'Gina', 'Snyder', '212', '5554141'),
('G11769', 'Thomas', 'Felder', '240', '6732190'),
('G12980', 'Jeremy', 'Smith', '352', '2158662');
/* Group 10 11-23-2021 */

INSERT INTO  G10_CONTACT (STUDENT_ID, GUARDIAN_ID, RELATIONSHIP_TYPE) VALUES
('S11200', 'G11448', 'Father'),
('S11201', 'G12395', 'Mother'),
('S11203','G13598', 'Mother'),
('S11032', 'G11769', 'Father'),
('S11304', 'G12980', 'Guardian'),
('S11404', 'G11769', 'Father');
 /* Group 10 11-23-2021 */

 --PART C
SELECT *
FROM G10_DEPARTMENT;
/* Group 10 11-23-2021 */

SELECT *
FROM G10_FACULTY;
/* Group 10 11-23-2021 */

SELECT *
FROM G10_PROGRAM;
/* Group 10 11-23-2021 */

SELECT *
FROM G10_BUILDING;
/* Group 10 11-23-2021 */

SELECT *
FROM G10_ROOM;
/* Group 10 11-23-2021 */

SELECT *
FROM G10_STUDENT;
/* Group 10 11-23-2021 */

SELECT *
FROM G10_GUARDIAN;
/* Group 10 11-23-2021 */

SELECT *
FROM G10_CONTACT;
/* Group 10 11-23-2021 */


--QUERY
--Query A
SELECT P.PROGRAM_NAME AS 'Programs with sufficient Budget'
FROM G10_PROGRAM P
	INNER JOIN G10_DEPARTMENT D ON D.DEPARTMENT_ID = P.DEPARTMENT_ID
WHERE P.PROGRAM_BUDGET >=500 AND D.DEPARTMENT_NAME IN ('ART','MUSIC');
/* Group 10 11-23-2021 */

--Query B
SELECT p.program_id, p.program_name, p.PROGRAM_DATE_START, p.PROGRAM_DATE_END, p.PROGRAM_FEE, r.room_number, r.room_capacity, b.building_number, b.building_name
FROM G10_PROGRAM p
	INNER JOIN g10_room r ON r.program_id = p.program_id
	INNER JOIN g10_building b ON b.BUILDING_NUMBER = r.BUILDING_NUMBER
WHERE p.PROGRAM_FEE > 0
	AND p.PROGRAM_FEE <= 10
	AND p.PROGRAM_FEE IS NOT NULL;
/* Group 10 11-23-2021 */

--Query C
GO
CREATE VIEW SECOND_GRADERS AS
SELECT S.STUDENT_ID, S.STUDENT_FNAME, S.STUDENT_LNAME
FROM G10_STUDENT S
WHERE S.GRADE = '2';
GO

SELECT * 
FROM SECOND_GRADERS;
/* Group 10 11-23-2021 */

--Query D
SELECT R.ROOM_NUMBER
FROM G10_ROOM R
WHERE R.PROGRAM_ID IN (
	SELECT P.PROGRAM_ID
	FROM G10_PROGRAM P
	WHERE P.PROGRAM_DATE_START = '2021-10-10'
);
/* Group 10 11-23-2021 */

--Query E
SELECT G.GUARDIAN_ID, G.GUARDIAN_FNAME, G.GUARDIAN_LNAME, COUNT(S.STUDENT_ID) AS 'Number of Students Enrolled for Next Year'
FROM G10_GUARDIAN G
	INNER JOIN G10_CONTACT C ON C.GUARDIAN_ID = G.GUARDIAN_ID
	INNER JOIN G10_STUDENT S ON C.STUDENT_ID = S.STUDENT_ID
WHERE S.GRADE != '5'
GROUP BY G.GUARDIAN_ID, G.GUARDIAN_FNAME, G.GUARDIAN_LNAME
HAVING COUNT(S.STUDENT_ID) >= 1;
/* Group 10 11-23-2021 */

--Query F1
SELECT D.DEPARTMENT_NAME AS 'Under Budgeted Departments'
FROM G10_DEPARTMENT D
WHERE D.DEPARTMENT_ID IN ( 
	SELECT P.DEPARTMENT_ID 
	FROM G10_PROGRAM P 
	WHERE P.PROGRAM_BUDGET < 500 
	GROUP BY P.DEPARTMENT_ID
	HAVING COUNT(P.PROGRAM_ID) < 3
);
/* Group 10 11-23-2021 */

--Query F2
SELECT P.PROGRAM_ID, P.PROGRAM_NAME
FROM G10_PROGRAM P
	INNER JOIN G10_DEPARTMENT D ON D.DEPARTMENT_ID = P.DEPARTMENT_ID
WHERE D.DEPARTMENT_NAME = 'MUSIC'
INTERSECT
SELECT P.PROGRAM_ID, P.PROGRAM_NAME
FROM G10_PROGRAM P
WHERE P.PROGRAM_FEE = 0 
	AND P.PROGRAM_DATE_START = '2021-09-01';
/* Group 10 11-23-2021 */

--PART D
DROP TABLE G10_CONTACT;
/* Group 10 11-23-2021 */

DROP TABLE G10_GUARDIAN;
/* Group 10 11-23-2021 */

DROP TABLE G10_STUDENT;
/* Group 10 11-23-2021 */

DROP TABLE G10_ROOM;
/* Group 10 11-23-2021 */

DROP TABLE G10_BUILDING;
/* Group 10 11-23-2021 */

DROP TABLE G10_PROGRAM;
/* Group 10 11-23-2021 */

DROP TABLE G10_FACULTY;
/* Group 10 11-23-2021 */

DROP TABLE G10_DEPARTMENT;  
/* Group 10 11-23-2021 */








